# Setup guide



The quick-start guide showed how to quickly launch a temporary instance of Web Apollo, but deploying the application to production normally involves some extra steps.


The general idea behind your deployment is to create a `apollo-config.groovy` file from some existing sample files which have sample settings for various database engines.


### Database configuration


Web Apollo supports several database backends, and you can choose sample configurations from using H2, Postgres, or MySQL by default.

Each has a file called `sample-h2-apollo-config.groovy` or `sample-postgres-apollo-config.groovy` that is designed to be
renamed to apollo-config.groovy before running `apollo deploy`.

Furthermore, the `apollo-config.groovy` has instructions for configuring test, development, and production modes, which will be selected automatically selected depending on how it is run, e.g:

* `apollo deploy` or `apollo release` use the production environment
* `apollo run-local` or `apollo debug` use the development environment
* `apollo test` uses the test environment



#### Configure for H2:
- H2 is an embedded database engine, so no external setups are needed. Simply copy sample-h2-apollo-config.groovy to apollo-config.groovy.

#### Configure for PostgreSQL:
- Create a new database with postgres for production mode (i.e. via the command line `createdb apollo-production`) and copy the sample-postgres-apollo-config.groovy to apollo-config.groovy.

#### Configure for MySQL:
- Create a new MySQL database for production mode (i.e. run `create database `apollo-production`` in the mysql console) and copy the sample-postgres-apollo-config.groovy to apollo-config.groovy.

*Note:* to deploy on tomcat you *NEED* to have a configured `apollo-config` file copied to deploy to production.


### Database schema

After you startup the application, the database schema (tables, etc.) is automatically setup. You don't have to initialize any database schemas yourself.

## Deploy the application

The `apollo run-local` command only launches a temporary server and should really not be used in production, so to deploy to production, we build a new WAR file with the `apollo deploy` command. After you have setup your `apollo-config.groovy` file, and it has the appropriate username, password, and JDBC URL in it, then we can run the command:



```
    ./apollo deploy
```


This command will package the application and it will download any missing pre-requisites (jbrowse) into a WAR file in the "target/" subfolder. After it completes, you can then copy the WAR file from the target folder to your webapps folder. If you name the file apollo.war in your webapps folder, then you can access your app at "http://localhost:8080/apollo"


Alternatively, as we alluded to previously, you can also launch a temporary instance of the server which is useful for testing

```
    ./apollo run-local 8080
```

This temporary server will be accessible at "http://localhost:8080/apollo"


### Note on database settings

If you use the `apollo run-local` command, then the "development" section of the apollo-config.groovy is used, but if you use the WAR file generated by the `apollo deploy` command on your own webserver, then the "production" section of the apollo-config.groovy is used.


## Detailed build instructions


While the shortcut `apollo deploy` takes care of basic application deployment, understanding the full build process of
Web Apollo 2.0 can help you to optimize and improve your deployed instances.

To learn more about the architecture of webapollo, view the [architecture guide](Architecture.html) but the main idea here is to
learn how to use `apollo release` to construct a build that includes javascript minimization


### Pre-requisites for Javascript minimization

In addition to the system [pre-requisites](Prerequisites.html), the javascript compilation will use nodejs, which can be
installed from a package manager on many platforms.

#### Install NodeJS

##### Debian/ubuntu

`sudo apt-get install nodejs`


##### CentOS/RedHat

`sudo yum install npm`

You may also need to install the `epel-release` package for this.

##### MacOSX/Homebrew

`brew install node`

#### Install extra perl modules

The `apollo release` command also requires some extra Perl modules, namely Text::Markdown and DateTime:

`cpanm DateTime Text::Markdown`

### Performing the javascript minimization

To build a Web Apollo release with Javascript minimization, you can use the command

```
    ./apollo release
```

This will compile JBrowse and Apollo javascript code into minimized files so that the number of HTTP requests that the client needs to make are reduced.

In all other respects, `apollo release` is exactly the same as `apollo deploy` though.


### Performing active development

To perform active development of the codebase, use

```
    ./apollo debug
```

This will launch a temporary instance of Web Apollo by running `grails run-app` and `ant devmode` at the same time, which means that any changes to the Java files will be picked up, allowing fast iteration.

If you modify the javascript files (i.e. the client directory), you can run `scripts/copy_client.sh` and these will be picked up on-the-fly too.


## Launching a temporary instance

A temporary tomcat server can be automatically launched without having you configure your own Tomcat server with the `apollo run-local` command:

```
    ./apollo run-local [8085]
```

The port number is an optional argument.


