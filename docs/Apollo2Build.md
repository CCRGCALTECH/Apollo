# Quick-start guide

There are two modes of installation.  Development, in which case you should (look here)[Architecture.md] or production, which will typically require an external separate database and producing a ```war``` file that will be placed in a webapp directory association with a server such as tomcat or resin.

## Install prerequisites

You will minimally need to install Java (Oracle or OpenJDK's version, Java (7 or greater), ([Grails](https://grails.org/), [git](https://git-scm.com/), [ant] (http://ant.apache.org/), and java web server - [tomcat, minimally 7.0.28](http://tomcat.apache.org/) or [resin](http://caucho.com/).  If you wish to use a database a non-embedded database (recommended for a production environment) you will have to install that separately.  
### Grails 
Installing grails is made easier by using [GVM](http://gvmtool.net/) which can automatically setup grails for you. We will use grails 2.4.5 for Web Apollo

1. curl -s get.gvmtool.net | bash
2. gvm install grails 2.4.5

### Get the code

To setup WebApollo, you can download the code from github:

- git clone https://github.com/GMOD/Apollo.git Apollo
- cd Apollo

Using a stable release tag might be suggested as well

### Verify install requirements

Once you have the pre-requisites installed and the code checked out, you can verify that it will work by typing:

```ant run-local```

and connecting to ```http://localhost:8080/apollo``` once is up and running.

You can the attempt to load an organism / tracks.  Any annotations created or organism rendered will not be recorded, but it is an easy way to verify that you have the pre-requisites installed and that your tracks are properly configured. 

## Basic configuration

Web Apollo 2.0 simplifies and expands options for the database setup. This section will cover the basic options for this in a production environment.

The general idea is to create a new ```apollo-config.groovy``` file from some existing samples to initialize your database settings.

## Database options


#### Configure for H2:
- To use H2 for your database, simply copy sample-h2-apollo-config.groovy to apollo-config.groovy
- Note: H2 is a 'zero-configuration' or 'embedded' database, so it doesn't require any external database to be setup

#### Configure for PostgreSQL:
- Create a new database with postgres (i.e. via the command line `createdb apollo-production`)
- Copy sample-postgres-apollo-config.groovy to apollo-config.groovy

#### Configure for MySQL:
- Create a new MySQL database (i.e. run `create database apollo-production` in the mysql console)
- Copy sample-mysql-apollo-config.groovy to apollo-config.groovy

### Database schema

After you create the database, the database schema (tables, etc.) is automatically formatted when the Web Apollo start to run in the web server.

## Deploy the application

After you have setup your apollo-config.groovy file, we will build a WAR file to deploy.  You will also need to modify it to include your username, password, and point to your database (the JDBC URL) in order to connect to a remote database if you are running in production.   

```
    ./apollo deploy
```

This command will download and package jbrowse and other prerequisites into a WAR file in the "target/" subfolder. After it completes, you can then copy the WAR file to your webapps folder. If you name the file apollo.war in your webapps folder, then you can access your app at "http://localhost:8080/apollo".


Alternatively, you can also launch a temporary server automatically, which makes it useful for testing

```
    ./apollo run-local 8080
```

This temporary server will be accessible at "http://localhost:8080/apollo"


### Note on database settings

If you use the `apollo run-local` command, then the "development" section of the apollo-config.groovy is used, but if you use the WAR file generated by the `apollo deploy` command on your own webserver, then the "production" section of the apollo-config.groovy is used.


## Setting up the application

### Login to the web interface

After copying the WAR file, the webapp will be deployed, and you can access it at http://localhost:8080/apollo/ or similar (the path will match whatever you named the WAR file) and you will be prompted for login information

![Login first time](images/1.png)

Figure 1. "Register First Admin User" screen allows you to create a new admin user.


![Organism configuration](images/2.png)

Figure 2. Navigate to the "Organism tab" and select "Create new organism". Then enter the new information for your
organism. Importantly, the data directory refers to a directory that has been prepared with the JBrowse data loading
scripts from the command line. See the [data loading](Data_loading.md) section for details.

![Open annotator](images/3.png)

Figure 3. Open up the new organism from the drop down tab on the annotator panel.



